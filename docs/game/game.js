import Ball from"../ball/ball.js";import Player from"../player/player.js";import*as cons from"../constants/constants.js";export default class Game{constructor(){this.players=[],this.ball=new Ball(cons.BOARD_WIDTH/2,cons.BOARD_HEIGTH/2),this.board=[],this.canvas=document.querySelector("canvas"),this.fps,this.addNewPlayer(),this.addNewPlayer(),this.goal(),this.setCanvas(),this.setBoard(),this.update()}addNewPlayer(){this.players.length<1?this.players.push(new Player(1,cons.PLAYERS_Y/2,1)):this.players.push(new Player(cons.BOARD_WIDTH-2,cons.PLAYERS_Y/2,2))}draw(){this.context.fillStyle="#0a0",this.context.fillRect(0,0,this.canvas.width,this.canvas.height),this.board.forEach((s,t)=>{s.forEach((s,i)=>{1==s||2==s?(this.context.fillStyle="#fff",this.context.fillRect(i,t,1,1)):"b"==s&&(this.context.fillStyle="#000",this.context.fillRect(i,t,1,1))})}),this.setPlayers(),this.setBall()}update(){this.draw(),this.fps=setTimeout(()=>this.update(),10),this.players.map(s=>10==s.score?this.finish(s):null)}finish(s){clearTimeout(this.fps);let t=document.getElementsByClassName("winner")[0];t.style.display="flex",t.children[0].innerHTML=`Partida finalizada ganador jugador ${s.id.toString()}`,document.getElementsByClassName("init")[1].style.display="initial"}setCanvas(){this.canvas.width=cons.BLOCK_SIZE*cons.BOARD_WIDTH,this.canvas.height=cons.BLOCK_SIZE*cons.BOARD_HEIGTH,this.context=this.canvas.getContext("2d"),this.context.scale(cons.BLOCK_SIZE,cons.BLOCK_SIZE)}setBoard(){for(let s=0;s<cons.BOARD_HEIGTH;s++){this.board.push([]);for(let t=0;t<cons.BOARD_WIDTH;t++)this.board[s].push(0)}}setBall(){(this.ball.getY()>=cons.BOARD_HEIGTH||this.ball.position.y-this.ball.speed<=0)&&(this.ball.direc.y*=-1),(this.player1Collision()||this.player2Collision())&&(this.ball.direc.x*=-1,this.ball.collision_players+=1,this.ball.collision_players%5==0&&(this.ball.speed+=.05)),(this.ball.getX()>=cons.BOARD_WIDTH||this.ball.position.x-this.ball.speed<=0)&&(this.ball.getX()>=cons.BOARD_WIDTH?this.goal(1):this.goal(2)),this.ball.position.x+=this.ball.direc.x*this.ball.speed,this.ball.position.y+=this.ball.direc.y*this.ball.speed,this.context.fillStyle="#000",this.context.fillRect(this.ball.position.x,this.ball.position.y,1,1)}player1Collision(){return this.ball.getY()>=this.players[0].position.y&&this.ball.position.y<=this.players[0].position.y+this.players[0].shape.length&&this.ball.position.x<=this.players[0].position.x+1}player2Collision(){return this.ball.getY()>=this.players[1].position.y&&this.ball.position.y<=this.players[1].position.y+this.players[1].shape.length&&this.ball.position.x>=this.players[1].position.x-1}setPlayers(){for(let s of this.players)s.shape.forEach((t,i)=>{t.forEach((t,l)=>{t&&(this.context.fillStyle="#fff",this.context.fillRect(l+s.position.x,i+s.position.y,1,1))})})}goal(s){this.ball=new Ball(cons.BOARD_WIDTH/2,cons.BOARD_HEIGTH/2),1==s?this.players[0].newScore():2==s&&this.players[1].newScore(),document.getElementById("player1").innerHTML=this.players[0].score,document.getElementById("player2").innerHTML=this.players[1].score}};